## ğŸ—“ MongoDBå­¦ç¿’è¨˜éŒ²ï¼ˆ4/17, 4/18ï¼‰
4/17 13:00-14:00
4/18 7:42-8:57(-16) 21:56-22:46
https://www.youtube.com/watch?v=JBCykXLfvv0&t=1136s

---

### ğŸ” MongoDBæ¦‚è¦

- RDBã‹ã‚‰NoSQLã¸ã®ã‚·ãƒ•ãƒˆ
- JSONå½¢å¼ã®ã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ€è€ƒã€
- å‹•çš„ã‚¹ã‚­ãƒ¼ãƒè¨­å®šãŒå¯èƒ½ï¼ˆæŸ”è»Ÿãªæ§‹é€ ï¼‰
- å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã«å¼·ãã€SQLä¸è¦ã§æ‰±ãˆã‚‹
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼ â†’ DBã®æ§‹æˆ

---

### ğŸ§± æ§‹ç¯‰æ‰‹é †

#### 1. åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
npm init -y
npm i express mongoose nodemon
```

`package.json` ã«ä»¥ä¸‹è¿½åŠ ã§ `npm run dev` ã§è‡ªå‹•å†èµ·å‹•å¯èƒ½:

```json
"scripts": {
  "dev": "nodemon server.js"
}
```

#### 2. `server.js` åŸºæœ¬æ§‹æˆ

```js
const express = require("express");
const app = express();
const mongoose = require("mongoose");
const foodRouter = require("./routes/foodRoutes");

app.use(foodRouter);

mongoose
  .connect("mongodb+srv://shincodeyoutube:abc@cluster0.8b8hp.mongodb.net/food?retryWrites=true&w=majority&appName=Cluster0")
  .then(() => console.log("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸã—ãŸã‚ˆ"))
  .catch(err => console.log(err));

app.listen(3000, () => {
  console.log("ã•ãƒ¼ã°ãã©ã†ã—ãŸã‚ˆ");
});
```

---

### ğŸŒ± ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆ`models/Food.js`ï¼‰

```js
const mongoose = require("mongoose");

const FoodSchema = new mongoose.Schema({
  name: { type: String, required: true, trim: true, lowercase: true },
  calories: {
    type: Number,
    default: 0,
    validate(value) {
      if (value < 0) throw new Error("ãƒã‚¤ãƒŠã‚¹ã®ã‚«ãƒ­ãƒªãƒ¼ã¯å­˜åœ¨ã—ãªã„ã‚ˆ");
    },
  },
});

const Food = mongoose.model("Food", FoodSchema);
module.exports = Food;
```

---

### ğŸ“¡ APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ`routes/foodRoutes.js`ï¼‰

```js
const express = require("express");
const app = express();
const foodModel = require("../models/Food");

app.use(express.json());

// å–å¾—ï¼ˆGETï¼‰
app.get("/foods", async (req, res) => {
  try {
    const foods = await foodModel.find({});
    res.send(foods);
  } catch (err) {
    res.status(500).send(err);
  }
});

// ä½œæˆï¼ˆPOSTï¼‰
app.post("/food", async (req, res) => {
  const food = new foodModel(req.body);
  try {
    await food.save();
    res.send(food);
  } catch (err) {
    res.status(500).send(err);
  }
});

// æ›´æ–°ï¼ˆPATCHï¼‰
app.patch("/food/:id", async (req, res) => {
  try {
    await foodModel.findByIdAndUpdate(req.params.id, req.body);
    res.send("æ›´æ–°å®Œäº†");
  } catch (err) {
    res.status(500).send(err);
  }
});

// å‰Šé™¤ï¼ˆDELETEï¼‰
app.delete("/food/:id", async (req, res) => {
  try {
    await foodModel.findByIdAndDelete(req.params.id);
    res.send("å‰Šé™¤å®Œäº†");
  } catch (err) {
    res.status(500).send(err);
  }
});

module.exports = app;
```

---

### ğŸ›  ãƒˆãƒ©ãƒ–ãƒ«ã¨å¯¾å¿œ

#### âŒ DNSã‚¨ãƒ©ãƒ¼ï¼ˆETIMEOUTï¼‰

```
Error: querySrv ETIMEOUT _mongodb._tcp.cluster0.8b8hp.mongodb.net
```

- åŸå› ï¼šiPhoneãƒ†ã‚¶ãƒªãƒ³ã‚°ãªã©ä¸€éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã§DNSè§£æ±ºä¸å¯
- è§£æ±ºï¼šä¼šç¤¾Wi-Fiã«åˆ‡ã‚Šæ›¿ãˆãŸã‚‰æˆåŠŸ

---

### ğŸ§ª ãƒ†ã‚¹ãƒˆ

- Postmanã‚’ä½¿ã£ã¦POST, GET, PATCH, DELETEã‚’ç¢ºèª
- MongoDB Atlasã®Data Explorerã‹ã‚‰ã‚‚DBãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªå¯èƒ½

ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
ã‚‚ã¡ã‚ã‚“ï¼ä»¥ä¸‹ã§ `server.js`ã€`models/Food.js`ã€`routes/foodRoutes.js` ã®3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã€**åˆå¿ƒè€…ã«ã‚‚ã‚ã‹ã‚Šã‚„ã™ã**1ã¤ãšã¤ä¸å¯§ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

---

## ğŸ§  1. `server.js` ã®è§£èª¬

```js
const express = require("express");
const app = express();
const mongoose = require("mongoose");
const foodRouter = require("./routes/foodRoutes");

app.use(foodRouter);
```

### âœ… å„è¡Œã®æ„å‘³

- `express`ï¼š
  - è»½é‡ãªWebã‚µãƒ¼ãƒãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚APIã‚µãƒ¼ãƒãƒ¼ã‚’ç°¡å˜ã«ä½œã‚Œã‚‹ã€‚
- `app = express()`ï¼š
  - Expressã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–ã€‚
- `mongoose`ï¼š
  - MongoDBã¨Node.jsã‚’ã¤ãªããƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚DBã¨ã‚„ã‚Šã¨ã‚Šã—ã‚„ã™ãã™ã‚‹ã€‚
- `foodRouter`ï¼š
  - `routes/foodRoutes.js` ã§å®šç¾©ã—ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’èª­ã¿è¾¼ã‚€ã€‚
- `app.use(foodRouter)`ï¼š
  - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç™»éŒ²ã™ã‚‹ã€‚`GET /foods` ãªã©ãŒæœ‰åŠ¹ã«ã€‚

---

```js
mongoose
  .connect("mongodb+srv://shincodeyoutube:abc@cluster0.8b8hp.mongodb.net/food?retryWrites=true&w=majority&appName=Cluster0")
  .then(() => console.log("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸã—ãŸã‚ˆ"))
  .catch(err => console.log(err));
```

- MongoDBã«æ¥ç¶šã™ã‚‹éƒ¨åˆ†
- `mongoose.connect(...)` ã«æ¥ç¶šæ–‡å­—åˆ—ï¼ˆURIï¼‰ã‚’æ¸¡ã™ã“ã¨ã§ã€Atlasã«æ¥ç¶š
- `.then()`ï¼šæˆåŠŸæ™‚ã®ãƒ­ã‚°
- `.catch()`ï¼šå¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°

---

```js
app.listen(3000, () => {
  console.log("ã•ãƒ¼ã°ãã©ã†ã—ãŸã‚ˆ");
});
```

- ã‚µãƒ¼ãƒãƒ¼ã‚’3000ç•ªãƒãƒ¼ãƒˆã§èµ·å‹•
- ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `node server.js` ã§å®Ÿè¡Œã™ã‚‹ã¨ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚‹

---

## ğŸ“¦ 2. `models/Food.js` ã®è§£èª¬

```js
const mongoose = require("mongoose");
```

- Mongooseã‚’ä½¿ã†ãŸã‚ã«èª­ã¿è¾¼ã¿

---

```js
const FoodSchema = new mongoose.Schema({
  name: { type: String, required: true, trim: true, lowercase: true },
  calories: {
    type: Number,
    default: 0,
    validate(value) {
      if (value < 0) throw new Error("ãƒã‚¤ãƒŠã‚¹ã®ã‚«ãƒ­ãƒªãƒ¼ã¯å­˜åœ¨ã—ãªã„ã‚ˆ");
    },
  },
});
```

### ğŸ” å„é …ç›®ã®æ„å‘³

- `name`ï¼š
  - ãƒ‡ãƒ¼ã‚¿å‹ã¯æ–‡å­—åˆ— (`String`)
  - `required: true` â†’ å…¥åŠ›å¿…é ˆ
  - `trim: true` â†’ å‰å¾Œã®ç©ºç™½ã‚’é™¤ã
  - `lowercase: true` â†’ è‡ªå‹•çš„ã«å°æ–‡å­—ã«å¤‰æ›

- `calories`ï¼š
  - ãƒ‡ãƒ¼ã‚¿å‹ã¯æ•°å­— (`Number`)
  - `default: 0` â†’ ä½•ã‚‚æŒ‡å®šãŒãªã„ã¨ãã¯ 0
  - `validate` â†’ 0æœªæº€ãªã‚‰ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™

---

```js
const Food = mongoose.model("Food", FoodSchema);
module.exports = Food;
```

- ã‚¹ã‚­ãƒ¼ãƒã‚’å…ƒã« `Food` ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
- ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ãˆã‚‹ã‚ˆã†ã« `export`

---

## ğŸ›£ 3. `routes/foodRoutes.js` ã®è§£èª¬

```js
const express = require("express");
const app = express();
const foodModel = require("../models/Food");
```

- Expressã¨ã€å…ˆã»ã©å®šç¾©ã—ãŸ `Food` ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€

---

```js
app.use(express.json());
```

- `req.body` ã‚’JSONã¨ã—ã¦å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆPOSTã‚„PATCHã®ã¨ãå¿…é ˆï¼‰

---

### GETãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```js
app.get("/foods", async (req, res) => {
  try {
    const foods = await foodModel.find({});
    res.send(foods);
  } catch (err) {
    res.status(500).send(err);
  }
});
```

- ã™ã¹ã¦ã®é£Ÿå“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¿”ã™

---

### POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæ–°è¦è¿½åŠ ï¼‰

```js
app.post("/food", async (req, res) => {
  const food = new foodModel(req.body);
  try {
    await food.save();
    res.send(food);
  } catch (err) {
    res.status(500).send(err);
  }
});
```

- æ–°ã—ã„é£Ÿå“ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆ`req.body`ã®å†…å®¹ã‚’ä¿å­˜ï¼‰

---

### PATCHãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆéƒ¨åˆ†ä¿®æ­£ï¼‰

```js
app.patch("/food/:id", async (req, res) => {
  try {
    await foodModel.findByIdAndUpdate(req.params.id, req.body);
    res.send("æ›´æ–°å®Œäº†");
  } catch (err) {
    res.status(500).send(err);
  }
});
```

- `:id` ã§æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¸€éƒ¨ã‚’ä¿®æ­£
- `req.body` ã®å†…å®¹ã«å¾“ã£ã¦æ›´æ–°

---

### DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆå‰Šé™¤ï¼‰

```js
app.delete("/food/:id", async (req, res) => {
  try {
    await foodModel.findByIdAndDelete(req.params.id);
    res.send("å‰Šé™¤å®Œäº†");
  } catch (err) {
    res.status(500).send(err);
  }
});
```

- `:id` ã§æŒ‡å®šã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•ï¼ˆPostmanï¼‰

- `GET /foods`ï¼šå…¨ãƒ‡ãƒ¼ã‚¿å–å¾—
- `POST /food`ï¼šæ–°è¦ä½œæˆ  
  ä¾‹:  
  ```json
  {
    "name": "apple",
    "calories": 95
  }
  ```
- `PATCH /food/<id>`ï¼šéƒ¨åˆ†æ›´æ–°
- `DELETE /food/<id>`ï¼šå‰Šé™¤

---

ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼
MongoDB 4/17 13:00-14:00ã€€4/18 7:42-8:57(-16) 21:56-22:46
https://www.youtube.com/watch?v=JBCykXLfvv0&t=1136s

RDBâ†’NoSQL
Jsonå½¢å¼ã€€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ€è€ƒ

å‹•çš„ã‚¹ã‚­ãƒ¼ãƒè¨­å®š
å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚æŒã‘ã‚‹
SQLæ–‡çŸ¥ã‚‰ãªãã¦ã‚‚ä½¿ãˆã‚‹ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ†’ã‚µãƒ¼ãƒãƒ¼â†’DB

6â€™00================

server.js

npm init -y

mondooseã¯expressã¨DBã‚’ç¹‹ã
npm i express mongoose nodemon

run devã§nodmonä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

express =require
app =express()
mongoose =require

app.listen(3000,()=>{log}

9â€™00================
ãƒ‡ãƒ¼ã‚¿ä½œã‚‹ã‚ˆ

mongodb hotmailã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
shincodeyoutube:abc

11â€™40ï¼Ÿï¼Ÿï¼Ÿdatabase deploymentãŒã‚ã‹ã‚‰ãªã„

ã‚¹ã‚­ãƒ¼ãƒæ§‹é€ ã‚’ä½œæˆã™ã‚‹
models/Food.js

16â€™10ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

DNSæ¥ç¶šãŒã†ã¾ãã„ã‹ãªã„ iphoneã®ãƒ†ã‚¶ãƒªãƒ³ã‚°ã¯ç„¡ç†ã€‚DNSã®è¨­å®šã‚’8888ã¨ã‹ã«ã™ã‚‹ã®ã‚‚googleã®ã‚’ä½¿ã†ã®ã‚‚ç„¡ç†ã€‚
â†’ä¼šç¤¾ã®wifiä½¿ã£ãŸã‚‰ã„ã‘ãŸã€‚
â€”â€”â€”â€”â€”â€”
Error: querySrv ETIMEOUT _mongodb._tcp.cluster0.8b8hp.mongodb.net
    at QueryReqWrap.onresolve [as oncomplete] (node:internal/dns/promises:251:17) {
  errno: undefined,
  code: 'ETIMEOUT',
  syscall: 'querySrv',
  hostname: '_mongodb._tcp.cluster0.8b8hp.mongodb.net'
}
â€”â€”â€”â€”â€”â€”â€”
20â€™00ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
ãƒ«ãƒ¼ãƒˆè¨­å®š
foodRoutes.js
async
try catch

ä¸Šã®ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«app.useã‚’server.jsã—ãªãã‚ƒã„ã‘ãªã„

postãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã‚‹ã€‚

jsonå½¢å¼ã§postã§ãã‚‹ã‚ˆã†ã«foodRoutes.jsã«æ›¸ãè¾¼ã‚€ã€‚

postmanã‚’ä½¿ã£ã¦ã€postã—ã¦ã€ãã‚Œã‚’getã™ã‚‹
31â€™00ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
ãƒ‡ãƒ¼ã‚¿éƒ¨åˆ†ä¿®æ­£PATCH
foodRoutes.js
idã‚’æŒ‡å®šã—ã¦ä¿®æ­£ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚patch
findByIdANdUpdateé–¢æ•°ã‚’ä½¿ã†

MongoDBã®ç®¡ç†ã‚µã‚¤ãƒˆã§ã‚‚ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã‚‹ã€‚clusterã®Data explorerã«è¡Œã‘ã°è¦‹ã‚Œã‚‹
